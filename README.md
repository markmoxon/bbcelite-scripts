# Scripts for generating the bbcelite.com website and associated repositories

This repository contains scripts that generate the following repositories, which contain the Elite source code for seven different platforms:

* [BBC Micro (cassette) Elite source code](https://github.com/markmoxon/cassette-elite-beebasm)
* [BBC Micro (disc) Elite source code](https://github.com/markmoxon/disc-elite-beebasm)
* [6502 Second Processor Elite source code](https://github.com/markmoxon/6502sp-elite-beebasm)
* [BBC Master Elite source code](https://github.com/markmoxon/master-elite-beebasm)
* [Acorn Electron Elite source code](https://github.com/markmoxon/electron-elite-beebasm)
* [Elite-A source code](https://github.com/markmoxon/elite-a-beebasm)
* [NES Elite source code](https://github.com/markmoxon/nes-elite-beebasm)

The scripts also generate the source code, comparison, index and statistics sections of the following disassembly websites:

* [Elite website](https://www.bbcelite.com)
* [Aviator website](https://aviator.bbcelite.com)
* [Revs website](https://revs.bbcelite.com)
* [Lander website](https://lander.bbcelite.com)

All of the above are generated by scripts, with the content coming from the following hand-crafted repositories:

* [Elite source code library](https://github.com/markmoxon/library-elite-beebasm)
* [Aviator source code](https://github.com/markmoxon/aviator-beebasm)
* [Revs source code](https://github.com/markmoxon/revs-beebasm)
* [Lander source code](https://github.com/markmoxon/archimedes-lander)

These repositories contain the source material for the generated sections of all four bbcelite.com websites. The static content of each website will be released separately.

Note that I have only tested this build process on a Mac. In theory these scripts should also work in Linux, and they might also work on Windows using Git Bash or Windows Subsystem for Linux, but I haven't tried anything other than a Mac-based build.

Python 3 is required.

## Setting up the scripts

The following steps will enable you to run the scripts and see them generate the source code repositories and bbcelite.com websites.

### 1. Clone the Elite repositories

Create a parent folder to hold the various repositories and websites that we are going to generate, and set the current directory to this folder. I will refer to this path as `/path/to/generated/content` in the following documentation; you should change this to the actual path of the folder that you create:

```
mkdir /path/to/generated/content
cd /path/to/generated/content
```

Clone the [library-elite-beebasm](https://github.com/markmoxon/library-elite-beebasm) and [bbcelite-scripts](https://github.com/markmoxon/bbcelite-scripts) repositories into the parent folder:

```
git clone https://github.com/markmoxon/library-elite-beebasm
git clone https://github.com/markmoxon/bbcelite-scripts
```

Create empty folders that will hold the generated source code repositories:

```
mkdir cassette-elite-beebasm
mkdir disc-elite-beebasm
mkdir 6502sp-elite-beebasm
mkdir master-elite-beebasm
mkdir electron-elite-beebasm
mkdir elite-a-beebasm
mkdir nes-elite-beebasm
```

Create folders for the website and staging website repository:

```
mkdir bbcelite.com
mkdir staging.bbcelite.com
```

These will contain identical content, but there are two of them to allow content changes to be tracked via a staging repository that is separate from the website content in the web server (as the latter mixes generated and static content).

### 2. Clone the Aviator, Revs and Lander repositories

Create folders for the website and staging website repository for each of the three other sites (Aviator, Revs and Lander):

```
mkdir aviator.bbcelite.com
mkdir staging.aviator.bbcelite.com

mkdir revs.bbcelite.com
mkdir staging.revs.bbcelite.com

mkdir lander.bbcelite.com
mkdir staging.lander.bbcelite.com
```

Clone the source code repositories for Aviator, Revs and Lander:

```
git clone https://github.com/markmoxon/aviator-beebasm
git clone https://github.com/markmoxon/revs-beebasm
git clone https://github.com/markmoxon/archimedes-lander
```

### 3. Set environment variables

We now set the environment variables that are needed by the generation scripts.

To do this, create a file called `env.sh` containing the following, making sure you change `/path/to/generated/content` to the correct path for the parent folder you created in step 1:

```
export BBCELITE_SCRIPTS=/path/to/generated/content/bbcelite-scripts

export ELITE_CODE_REPOSITORIES=/path/to/generated/content
export ELITE_WEBSITE=/path/to/generated/content/bbcelite.com
export ELITE_WEBSITE_REPOSITORY=/path/to/generated/content/staging.bbcelite.com

export AVIATOR_CODE_REPOSITORY=/path/to/generated/content/aviator-beebasm
export AVIATOR_WEBSITE=/path/to/generated/content/aviator.bbcelite.com
export AVIATOR_WEBSITE_REPOSITORY=/path/to/generated/content/staging.aviator.bbcelite.com

export REVS_CODE_REPOSITORY=/path/to/generated/content/revs-beebasm
export REVS_WEBSITE=/path/to/generated/content/revs.bbcelite.com
export REVS_WEBSITE_REPOSITORY=/path/to/generated/content/staging.revs.bbcelite.com

export LANDER_CODE_REPOSITORY=/path/to/generated/content/archimedes-lander
export LANDER_WEBSITE=/path/to/generated/content/lander.bbcelite.com
export LANDER_WEBSITE_REPOSITORY=/path/to/generated/content/staging.lander.bbcelite.com
```

Execute this with the following command, to set the environment variables:

```
source env.sh
```

[See below](#environment-variables) for details on these environment variables, advice on automating this step, and information on how to set up a different folder structure to the all-in-one approach used in this example.

### 4. Run the scripts for Elite

Now let's generate the Elite source repositories and website.

First, switch to the `bbcelite-scripts` repository folder:

```
cd $BBCELITE_SCRIPTS
```

Now generate the repositories and website by running this script (this will take quite a while to run):

```
./generate-elite.sh
```

This will generate source code in each of the empty `*-elite-beebasm` folders using the content from the library repository, and it will then generate the code pages for the [bbcelite.com](https://www.bbcelite.com) site from the contents of those source code folders.

In other words, it will create the contents of the following repositories in the `*-elite-beebasm` folders that we created in step 1:

* [cassette-elite-beebasm](https://github.com/markmoxon/cassette-elite-beebasm)
* [disc-elite-beebasm](https://github.com/markmoxon/disc-elite-beebasm)
* [6502sp-elite-beebasm](https://github.com/markmoxon/6502sp-elite-beebasm)
* [master-elite-beebasm](https://github.com/markmoxon/master-elite-beebasm)
* [electron-elite-beebasm](https://github.com/markmoxon/electron-elite-beebasm)
* [elite-a-beebasm](https://github.com/markmoxon/elite-a-beebasm)
* [nes-elite-beebasm](https://github.com/markmoxon/nes-elite-beebasm)

and it will create a set of website pages in the `bbcelite.com` and `staging.bbcelite.com` folders.

Changing the library content and re-running the generation script will automatically update both the source code repositories and website.

### 5. Run the scripts for Aviator, Revs and Lander

Next, let's generate the other websites by running the relevant generate scripts.

This command:

```
./generate-aviator.sh
```

will generate the code pages for the [aviator.bbcelite.com](https://aviator.bbcelite.com) site and the corresponding staging repository, taking the source code from the [aviator-beebasm](https://github.com/markmoxon/aviator-beebasm) source code repository.

Similarly, this command:

```
./generate-revs.sh
```

will generate the [revs.bbcelite.com](https://revs.bbcelite.com) site and staging repository from the [revs-beebasm](https://github.com/markmoxon/revs-beebasm) source code repository, and this command:

```
./generate-lander.sh
```

will generate the [lander.bbcelite.com](https://lander.bbcelite.com) site and staging repository from the [archimedes-lander](https://github.com/markmoxon/archimedes-lander) source code repository.

### 6. Merge the generated web content into the static website

The final step is to merge the generated website content with the static website content, such as the deep dives, homepage, images, CSS, JavaScript and so on. I have not yet released the static content to a public repository, but I plan to, at which point you will be able to generate the websites in their entirety.

The websites also use various PHP includes, so at this stage you can't get the websites working locally. The static repository will fix this, allowing you to generate the entire bbcelite.com website and host it locally.

## Environment variables

The following environment variables need to be set up for the scripts to work. They should contain the full paths of the relevant folders that are used by the generation process.

### All sites

`$BBCELITE_SCRIPTS` = this repository (i.e. bbcelite-scripts)

### Elite

`$ELITE_CODE_REPOSITORIES` = the folder containing the `*-elite-beebasm` repositories that we cloned above

`$ELITE_WEBSITE` = the root folder of the Elite website we want to generate

`$ELITE_WEBSITE_REPOSITORY` = a staging repository for tracking changes to the generated site

### Aviator

`$AVIATOR_CODE_REPOSITORY` = the path of the aviator-beebasm repository that we cloned above

`$AVIATOR_WEBSITE` = the root folder of the Aviator website we want to generate

`$AVIATOR_WEBSITE_REPOSITORY` = a staging repository for tracking changes to the generated site

### Revs

`$REVS_CODE_REPOSITORY` = the path of the revs-beebasm repository that we cloned above

`$REVS_WEBSITE` = the root folder of the Revs website we want to generate

`$REVS_WEBSITE_REPOSITORY` = a staging repository for tracking changes to the generated site

### Lander

`$LANDER_CODE_REPOSITORY` = the path of the archimedes-lander repository that we cloned above

`$LANDER_WEBSITE` = the root folder of the Lander website we want to generate

`$LANDER_WEBSITE_REPOSITORY` = a staging repository for tracking changes to the generated site

### How to set the environment variables

The environment variablea can be set using the `source` approach in the above example.

Alternatively you can add the `export` commands to your `.zshenv` file so that the variables are set for every shell that you open, so you don>t have to run the `source` command each time you open a new terminal.

If you do this, then after updating `.zshenv`, you should close and re-open the terminal and `cd` back into the folder, to ensure that the variables are set.

---

Right on, Commanders!

_Mark Moxon_